<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Endpoint N8N</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .warning { background: #fff3cd; border-color: #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Endpoint N8N</h1>
        
        <div class="test-section">
            <h3>üì° Configura√ß√£o do Endpoint</h3>
            <p><strong>URL:</strong> https://n8n.admin.hitechdesenvolvimento.com.br/webhook-test/554ce0ca-4b36-4d56-a2ce-79d874533ca0</p>
            <button onclick="testWebhookTest()">üß™ Testar Webhook</button>
            <button onclick="clearLog()">üóëÔ∏è Limpar Log</button>
        </div>

        <div class="test-section">
            <h3>üìù Dados de Teste</h3>
            <label>Lead ID:</label>
            <input type="text" id="leadId" value="test-lead-123" placeholder="ID do lead cadastrado no banco">
            
            <p style="color: #666; font-size: 14px; margin-top: 10px;">
                ‚ÑπÔ∏è <strong>Importante:</strong> O webhook N8N deve buscar os dados completos do lead no banco usando este ID.
            </p>
        </div>

        <div class="test-section">
            <h3>üìã Log de Teste</h3>
            <div id="testLog" class="log"></div>
        </div>

        <div class="test-section">
            <h3>üìä Resposta do N8N</h3>
            <div id="responseData" class="log">Aguardando teste...</div>
        </div>
    </div>

    <script>
        const N8N_WEBHOOK_URL = 'https://n8n.admin.hitechdesenvolvimento.com.br/webhook/554ce0ca-4b36-4d56-a2ce-79d874533ca0';
        const N8N_WEBHOOK_TEST_URL = 'https://n8n.admin.hitechdesenvolvimento.com.br/webhook-test/554ce0ca-4b36-4d56-a2ce-79d874533ca0';
        let testLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            testLog.push(logMessage);
            
            const logElement = document.getElementById('testLog');
            logElement.textContent = testLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logMessage);
        }

        function clearLog() {
            testLog = [];
            document.getElementById('testLog').textContent = '';
            document.getElementById('responseData').textContent = 'Log limpo.';
        }

        async function testConnection() {
            log('üîç Testando conex√£o b√°sica com N8N...');
            
            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify({ test: 'connection' })
                });

                log(`üì° Status: ${response.status} ${response.statusText}`);
                log(`‚úÖ OK: ${response.ok}`);

                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Conex√£o OK! Resposta recebida.');
                    document.getElementById('responseData').textContent = JSON.stringify(data, null, 2);
                } else {
                    log(`‚ùå Erro na conex√£o: ${response.status}`);
                    const errorText = await response.text();
                    document.getElementById('responseData').textContent = errorText;
                }
            } catch (error) {
                log(`‚ùå Erro de rede: ${error.message}`);
                document.getElementById('responseData').textContent = `Erro: ${error.message}`;
            }
        }

        async function testPaymentData() {
            log('üí≥ Testando envio de lead_id para N8N...');
            
            const testData = {
                lead_id: document.getElementById('leadId').value
            };

            log('üì§ Dados enviados (apenas lead_id):');
            log(JSON.stringify(testData, null, 2));

            try {
                const response = await fetch(N8N_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(testData)
                });

                log(`üì° Status: ${response.status} ${response.statusText}`);
                log(`‚úÖ OK: ${response.ok}`);

                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Dados enviados com sucesso!');
                    log('üì• Resposta do N8N:');
                    log(JSON.stringify(data, null, 2));
                    
                    document.getElementById('responseData').textContent = JSON.stringify(data, null, 2);
                    
                    // Verificar se tem link de pagamento
                    if (data.payment_url || data.url || data.link) {
                        log('üîó Link de pagamento encontrado!');
                        log(`URL: ${data.payment_url || data.url || data.link}`);
                    }
                } else {
                    log(`‚ùå Erro no envio: ${response.status}`);
                    const errorText = await response.text();
                    log(`‚ùå Erro: ${errorText}`);
                    document.getElementById('responseData').textContent = errorText;
                }
            } catch (error) {
                log(`‚ùå Erro de rede: ${error.message}`);
                document.getElementById('responseData').textContent = `Erro: ${error.message}`;
            }
        }

        async function testWebhookTest() {
            log('üß™ Testando webhook de teste...');
            
            const testData = {
                lead_id: document.getElementById('leadId').value
            };

            log('üì§ Dados enviados para webhook-test:');
            log(JSON.stringify(testData, null, 2));

            try {
                const response = await fetch(N8N_WEBHOOK_TEST_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(testData)
                });

                log(`üì° Status: ${response.status} ${response.statusText}`);
                log(`‚úÖ OK: ${response.ok}`);

                if (response.ok) {
                    const data = await response.json();
                    log('‚úÖ Webhook de teste funcionando!');
                    log('üì• Resposta:');
                    log(JSON.stringify(data, null, 2));
                    
                    document.getElementById('responseData').textContent = JSON.stringify(data, null, 2);
                } else {
                    log(`‚ùå Erro no webhook de teste: ${response.status}`);
                    const errorText = await response.text();
                    log(`‚ùå Erro: ${errorText}`);
                    document.getElementById('responseData').textContent = errorText;
                }
            } catch (error) {
                log(`‚ùå Erro de rede: ${error.message}`);
                document.getElementById('responseData').textContent = `Erro: ${error.message}`;
            }
        }

        // Testar automaticamente ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de teste carregada');
            log(`üß™ Endpoint Test: ${N8N_WEBHOOK_TEST_URL}`);
        });
    </script>
</body>
</html>