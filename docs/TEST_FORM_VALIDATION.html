<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Valida√ß√£o Formul√°rio</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        input {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste Valida√ß√£o Formul√°rio</h1>
        
        <form id="testForm">
            <label>Nome Completo:</label>
            <input type="text" id="nomeCompleto" value="Jo√£o Silva Teste">
            
            <label>CPF/CNPJ:</label>
            <input type="text" id="cpfCnpj" value="12345678901">
            
            <label>WhatsApp:</label>
            <input type="text" id="whatsapp" value="5562999999999">
            
            <label>Email:</label>
            <input type="email" id="email" value="joao@teste.com">
            
            <label>CEP:</label>
            <input type="text" id="cep" value="74000000">
            
            <label>Cidade:</label>
            <input type="text" id="cidade" value="Goi√¢nia">
            
            <label>Bairro:</label>
            <input type="text" id="bairro" value="Centro">
            
            <label>Cor Principal:</label>
            <input type="color" id="primaryColor" value="#14446C">
            
            <label>Cor Secund√°ria:</label>
            <input type="color" id="secondaryColor" value="#CFBA7F">
            
            <button type="button" onclick="testValidations()">üîç Testar Valida√ß√µes</button>
            <button type="button" onclick="testFormSubmission()">üí≥ Simular Envio</button>
            <button type="button" onclick="clearLog()">üóëÔ∏è Limpar</button>
        </form>

        <div style="margin-top: 20px;">
            <h3>üìã Log de Teste</h3>
            <div id="testLog" class="log"></div>
        </div>
    </div>

    <script>
        let selectedPlan = 'profissional'; // Simular plano selecionado
        let testLog = [];

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            testLog.push(logMessage);
            
            const logElement = document.getElementById('testLog');
            logElement.textContent = testLog.join('\n');
            logElement.scrollTop = logElement.scrollHeight;
            
            console.log(logMessage);
        }

        function clearLog() {
            testLog = [];
            document.getElementById('testLog').textContent = '';
        }

        function testValidations() {
            log('üîç Testando valida√ß√µes...');
            
            const formData = {
                nome_completo: document.getElementById('nomeCompleto').value,
                cpf_cnpj: document.getElementById('cpfCnpj').value,
                whatsapp: document.getElementById('whatsapp').value,
                email: document.getElementById('email').value,
                cep: document.getElementById('cep').value,
                cidade: document.getElementById('cidade').value,
                bairro: document.getElementById('bairro').value,
                cor_principal: document.getElementById('primaryColor').value,
                cor_secundaria: document.getElementById('secondaryColor').value,
                plano_escolhido: selectedPlan
            };

            log('üìù Dados do formul√°rio:');
            log(JSON.stringify(formData, null, 2));

            // Testar valida√ß√µes
            log('üîç Validando campos obrigat√≥rios...');
            if (!formData.nome_completo || !formData.cpf_cnpj || !formData.whatsapp || !formData.email) {
                log('‚ùå Campos obrigat√≥rios n√£o preenchidos');
                return;
            }
            log('‚úÖ Campos obrigat√≥rios OK');

            // Testar CPF
            log('üîç Validando CPF/CNPJ...');
            const cpfValid = validateCPF(formData.cpf_cnpj.replace(/\D/g, ''));
            log(`üìã CPF ${formData.cpf_cnpj}: ${cpfValid ? '‚úÖ V√°lido' : '‚ùå Inv√°lido'}`);

            // Testar telefone
            log('üîç Validando telefone...');
            const phoneValid = validatePhone(formData.whatsapp);
            log(`üìû Telefone ${formData.whatsapp}: ${phoneValid ? '‚úÖ V√°lido' : '‚ùå Inv√°lido'}`);

            log('‚úÖ Teste de valida√ß√µes conclu√≠do');
        }

        async function testFormSubmission() {
            log('üí≥ Simulando envio do formul√°rio...');
            
            const formData = {
                nome_completo: document.getElementById('nomeCompleto').value,
                cpf_cnpj: document.getElementById('cpfCnpj').value,
                whatsapp: document.getElementById('whatsapp').value,
                email: document.getElementById('email').value,
                cep: document.getElementById('cep').value,
                cidade: document.getElementById('cidade').value,
                bairro: document.getElementById('bairro').value,
                cor_principal: document.getElementById('primaryColor').value,
                cor_secundaria: document.getElementById('secondaryColor').value,
                plano_escolhido: selectedPlan
            };

            log('üìù Dados coletados:');
            log(JSON.stringify(formData, null, 2));

            // Simular valida√ß√µes
            if (!formData.nome_completo || !formData.cpf_cnpj || !formData.whatsapp || !formData.email) {
                log('‚ùå Campos obrigat√≥rios n√£o preenchidos');
                return;
            }

            if (!validateCPF(formData.cpf_cnpj.replace(/\D/g, ''))) {
                log('‚ùå CPF/CNPJ inv√°lido');
                return;
            }

            if (!validatePhone(formData.whatsapp)) {
                log('‚ùå Telefone inv√°lido');
                return;
            }

            log('‚úÖ Valida√ß√µes passaram, simulando processamento...');
            
            // Simular processamento
            const planDetails = getPlanDetails(selectedPlan);
            log('üìä Detalhes do plano:');
            log(JSON.stringify(planDetails, null, 2));

            if (planDetails.price === 0) {
                log('üÜì Plano gratuito - criando acesso direto');
            } else {
                log('üí≥ Plano pago - processando pagamento via N8N');
                
                // Simular dados que seriam enviados para N8N
                const paymentRequest = {
                    lead_id: 'test-lead-id',
                    amount: planDetails.price,
                    payer_name: formData.nome_completo,
                    payer_email: formData.email,
                    payer_phone: formData.whatsapp.replace(/\D/g, ''),
                    payer_document: formData.cpf_cnpj.replace(/\D/g, ''),
                    description: `${planDetails.name} - CONECTADOS`,
                    plan_name: planDetails.name.toLowerCase()
                };

                log('üì§ Dados que seriam enviados para N8N:');
                log(JSON.stringify(paymentRequest, null, 2));
            }

            log('‚úÖ Simula√ß√£o conclu√≠da');
        }

        // Fun√ß√µes de valida√ß√£o (copiadas da landing page)
        function validateCPF(cpf) {
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            
            let sum = 0;
            for (let i = 0; i < 9; i++) {
                sum += parseInt(cpf[i]) * (10 - i);
            }
            let remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf[9])) return false;
            
            sum = 0;
            for (let i = 0; i < 10; i++) {
                sum += parseInt(cpf[i]) * (11 - i);
            }
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf[10])) return false;
            
            return true;
        }

        function validatePhone(phone) {
            const cleanPhone = phone.replace(/\D/g, '');
            if (cleanPhone.length !== 10 && cleanPhone.length !== 11) return false;
            if (/^(\d)\1{9,10}$/.test(cleanPhone)) return false;
            return true;
        }

        function getPlanDetails(planName) {
            const plans = {
                'gratuito': { name: 'Gratuito', price: 0, maxUsers: 100, features: ['100 cadastros'] },
                'essencial': { name: 'Essencial', price: 650, maxUsers: 1000, features: ['1.000 cadastros', 'Painel completo', 'Mapa interativo', 'Relat√≥rios', 'Backup', 'Suporte'] },
                'profissional': { name: 'Profissional', price: 1250, maxUsers: 5000, features: ['5.000 cadastros', 'Painel completo', 'Mapa interativo', 'Relat√≥rios', 'Backup', 'Suporte priorit√°rio'] },
                'avancado': { name: 'Avan√ßado', price: 1500, maxUsers: 999999, features: ['Cadastros ilimitados', 'Painel completo', 'Mapa interativo', 'Relat√≥rios', 'Backup', 'Suporte 24h'] }
            };
            return plans[planName] || plans['gratuito'];
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina de teste carregada');
            log(`üìã Plano simulado: ${selectedPlan}`);
        });
    </script>
</body>
</html>
